# Unidict 作为“专业词典”仍缺的关键能力清单

本文从“可日常替代 GoldenDict / 欧路 / macOS Dictionary、并服务重度语言学习”的角度，盘点 Unidict 已具备能力与仍明显缺失/不完整的能力，并给出优先级建议（P0 最高）。

> 口径：只按仓库当前实现（core/std + Qt adapters + qmlui/cli）做差距分析；“词典内容本身是否包含例句/音频”等不在本清单范围，但需要 App 能承载与呈现这些内容。

## 已具备（足以算“可用”）

- 离线词典加载：`MDict(.mdx)`、`StarDict(.ifo/.idx/.dict/.dict.dz)`、`DSL(.dsl)`、`JSON/CSV/TSV`
- 多种查找：`exact/prefix/fuzzy/wildcard/regex`，以及全文检索（倒排索引 + TF/IDF + 持久化/版本协商）
- 生词本与历史：本地持久化、导出 CSV、基础复习/学习页（QML）
- 基础同步：`SyncServiceQt`（本地 JSON 文件双向合并 + 预览/选择导入导出）
- AI 与语音：`AiServiceQt`（外部命令桥接 + mock fallback）、Qt `TextToSpeech`（可选 voice/preset）

## 缺失/不完整（“专业词典”关键差距）

### P0：词条呈现与资源（决定体验上限）
- **富文本/HTML 渲染不完整**：大量 MDX/StarDict 定义是 HTML/富文本，当前 UI 基本按纯文本展示；缺少 CSS、段落/列表/表格等排版策略。
- **资源文件（图片/音频）链路缺失**：MDict `.mdd`、StarDict 资源/外链图片常见；目前没有“解析资源 → 缓存 → 安全 URL 重写 → UI 展示”的闭环。
- **交叉引用/链接不可点击**：词条内常见 `@@@LINK=...`、超链接、同义词跳转；缺少可点击跳转与返回栈。

### P0：词典兼容性与编码（决定能否“加载你现有的词典库”）
- **StarDict `ifo` 关键字段未完整支持**：例如 `sametypesequence`、`charset`、`description` 多行等；当前 `lookup()` 直接返回 bytes，编码/类型序列解释不足。
- **MDict 真实世界兼容性仍需覆盖**：虽然 std-only MDict 已做大量块布局/边界用例，但仍缺“真实词典回归集 + 兼容性矩阵”；`.mdd` 资源仍未实现。
- **字符归一化不足**：大小写/重音/全半角/Unicode 兼容折叠、标点归一化对“专业查词”很关键（尤其多语种）。

### P1：结果组织与多词典工作流（决定“查得到且好用”）
- **多词典结果的聚合展示**：QML/CLI 的默认路径多为“命中第一个就返回”，缺少按词典分组、按优先级/权重排序、合并重复释义的 UI/接口。
- **词典管理能力不足**：启用/禁用、优先级、分组、按用途（英英/英汉/术语）切换；目前更偏“加载即全局生效”。
- **搜索高亮与片段预览**：全文检索/长释义需要命中高亮、snippet、跳转定位，否则可用性大幅下降。

### P1：快速取词（专业用户的“第二入口”）
- **剪贴板监听/划词/全局热键/悬浮窗**：当前有剪贴板读写桥，但缺少监听与“自动查词/弹窗/固定窗口”等能力。
- **系统托盘/菜单栏**：桌面词典常用入口与开机自启能力未闭环。

### P2：语言学习深度（从“能查”到“能学”）
- **SRS 算法与数据模型可扩展性**：需要可调度策略（SM-2/FSRS 等）、tag/分组、例句/来源词典、词条版本、笔记与高亮。
- **Anki/通用格式导出**：当前以 CSV 为主；对接 Anki（apkg/AnkiConnect）与更多字段映射会显著提升专业度。
- **发音练习/评测**：现阶段偏 TTS 播放；缺少录音、ASR、评分与反馈闭环。

### P2：同步、隐私与可迁移性
- **云同步/多端冲突解决**：当前同步更像“本地备份合并”，缺少账号、增量、冲突策略、端到端加密（E2EE）。
- **完整备份/恢复**：建议提供一键导出（设置 + 历史 + 生词本 + 学习进度 + 索引缓存策略）。

### P3：插件生态与在线能力（锦上添花但长期必需）
- **第三方插件动态加载与 API 稳定性**：当前更像“内建工厂注册”；缺少 ABI/API 版本、沙箱、安全模型、插件分发。
- **在线词典/词典商店**：下载/更新/校验与授权管理尚未形成产品闭环。

## 建议的下一步（按价值/难度比排序）

1. **P0：定义渲染与资源闭环**：先实现“可显示 HTML 子集 + 本地资源解析/重写/缓存”，再逐步增强 CSS 与安全策略。
2. **P0：多词典聚合结果 API + UI**：提供“按词典分组 + 优先级 + 一键切换”的展示；CLI 也支持 `--all` 的一致输出格式。
3. **P1：剪贴板监听（可选）+ 快捷键入口**：先做剪贴板监听触发查词（最小闭环），再扩展全局热键/悬浮窗。
4. **P1：编码与归一化策略**：引入统一 normalization（casefold/diacritics fold/Unicode NFKC 可配置），并补齐 StarDict `ifo` 解释。
5. **P2：学习数据模型升级**：为每个 vocab 项记录来源词典、释义快照、tag、复习参数；再考虑 Anki 导出与练习评测。

