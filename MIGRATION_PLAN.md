# 代码迁移计划

## 🎯 迁移目标

将现有的unidict项目重构为现代化的monorepo架构，保留核心功能的同时为新的go-zero后端和多端应用做准备。

## 📋 迁移策略

### 1. **保留和迁移**
- ✅ 保留核心C++词典解析库 (`core/` → `packages/core/`)
- ✅ 保留现有QML桌面客户端 (`qmlui/` → `apps/desktop/`)
- ✅ 保留CLI工具 (`cli-std/` → `tools/cli/`)
- ✅ 保留测试代码 (`tests/` → 保持位置)
- ✅ 保留示例数据 (`examples/` → `data/samples/`)

### 2. **重构和优化**
- 🔄 将构建系统从单一CMake改为多层次构建
- 🔄 整合现有适配器代码到共享库
- 🔄 标准化配置文件格式
- 🔄 优化依赖管理

### 3. **新增架构**
- 🆕 添加go-zero微服务后端
- 🆕 添加Web前端框架
- 🆕 添加移动端支持准备
- 🆕 添加现代化CI/CD流水线

## 🚀 迁移步骤

### 阶段1: 目录结构迁移
1. 创建新的monorepo目录结构
2. 迁移现有C++核心代码
3. 迁移QML桌面客户端
4. 迁移CLI工具和测试

### 阶段2: 构建系统重构
1. 创建根级CMakeLists.txt
2. 为各个子项目创建独立构建
3. 整合包管理系统
4. 配置跨平台构建

### 阶段3: 配置标准化
1. 统一配置文件格式
2. 创建环境特定配置
3. 建立配置验证机制
4. 支持动态配置更新

### 阶段4: 新架构集成
1. 添加go-zero服务框架
2. 创建API定义和文档
3. 集成数据库和缓存
4. 建立监控和日志系统

## 📂 迁移映射表

### 核心代码迁移
```
原路径                    →  新路径
core/                    →  packages/core/
core/std/                →  packages/core/std/
adapters/                →  packages/shared-cpp/adapters/
```

### 应用代码迁移
```
qmlui/                   →  apps/desktop/
cli/                     →  tools/cli/
cli-std/                 →  tools/cli-std/
gui/                     →  (废弃，功能整合到apps/desktop/)
```

### 配置和数据迁移
```
examples/                →  data/samples/
data/                    →  data/ (保持)
tests/                   →  tests/ (保持，添加新的测试结构)
docs/                    →  docs/ (扩展为完整文档系统)
```

### 构建文件迁移
```
CMakeLists.txt           →  packages/core/CMakeLists.txt
                         +  apps/desktop/CMakeLists.txt
                         +  CMakeLists.txt (根级)
```

## ⚠️ 注意事项

### 兼容性保证
- 保持现有API接口不变
- 确保构建产物路径兼容
- 维护配置文件向后兼容
- 保留重要的环境变量

### 依赖管理
- 通过CMake管理C++依赖
- 通过go.mod管理Go依赖
- 通过package.json管理Node.js依赖
- 统一第三方库版本管理

### 测试策略
- 迁移所有现有测试用例
- 添加回归测试验证
- 建立持续集成流水线
- 性能基准测试对比

## 🎯 迁移验收标准

### 功能验收
- [ ] 所有现有功能正常运行
- [ ] 构建系统成功生成可执行文件
- [ ] 测试用例100%通过
- [ ] 性能指标不低于原系统

### 架构验收
- [ ] Monorepo结构清晰合理
- [ ] 依赖关系明确无循环
- [ ] 配置管理标准化
- [ ] 文档完整准确

### 开发体验验收
- [ ] 一键式开发环境搭建
- [ ] 快速的增量构建
- [ ] 友好的错误提示
- [ ] 完善的开发工具支持

这个迁移计划确保了现有功能的连续性，同时为新架构的实现奠定了坚实基础。